{"ast":null,"code":"import React,{createContext,useState,useEffect}from\"react\";import{loginAPI,registerAPI}from\"../api/authAPI\";import{fetchUserDetailsAPI,updateUserDetailsAPI}from\"../api/userAPI\";import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[isLoggedIn,setIsLoggedIn]=useState(false);const[user,setUser]=useState(null);useEffect(()=>{const token=localStorage.getItem(\"authToken\");const userId=localStorage.getItem(\"userId\");if(token&&userId){fetchUserDetailsAPI(token,userId).then(data=>{setUser(data);setIsLoggedIn(true);}).catch(()=>{console.error(\"Session expired or invalid token.\");localStorage.removeItem(\"authToken\");localStorage.removeItem(\"userId\");setIsLoggedIn(false);});}},[]);const loginHandler=async(email,password)=>{try{const data=await loginAPI(email,password);localStorage.setItem(\"authToken\",data.token);// Store token\nconsole.log(\"Token saved to localstorage: \"+data.token);localStorage.setItem(\"userId\",data.user.id);// Store user ID\nconsole.log(\"User ID saved to localstorage: \"+data.user.id);setUser(data.user);// Set user in state\nsetIsLoggedIn(true);// Update logged-in state\nreturn true;}catch(error){console.error(\"Login failed:\",error.message);return false;}};const registerHandler=async userDetails=>{try{await registerAPI(userDetails);return true;}catch(error){console.error(\"Registration failed:\",error.message);return false;}};const updateDetailsHandler=async updatedDetails=>{try{const token=localStorage.getItem(\"authToken\");const updatedUser=await updateUserDetailsAPI(token,updatedDetails);setUser(updatedUser);alert(\"Details updated successfully.\");}catch(error){console.error(\"Failed to update user details:\",error.message);alert(\"Failed to update details. Please try again.\");}};const logoutHandler=()=>{localStorage.removeItem(\"authToken\");localStorage.removeItem(\"userId\");setUser(null);setIsLoggedIn(false);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{isLoggedIn,user,login:loginHandler,register:registerHandler,updateDetails:updateDetailsHandler,logout:logoutHandler},children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","loginAPI","registerAPI","fetchUserDetailsAPI","updateUserDetailsAPI","jsx","_jsx","AuthContext","AuthProvider","_ref","children","isLoggedIn","setIsLoggedIn","user","setUser","token","localStorage","getItem","userId","then","data","catch","console","error","removeItem","loginHandler","email","password","setItem","log","id","message","registerHandler","userDetails","updateDetailsHandler","updatedDetails","updatedUser","alert","logoutHandler","Provider","value","login","register","updateDetails","logout"],"sources":["C:/Users/popul/Documents/Programming/Sendable/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from \"react\";\r\nimport { loginAPI, registerAPI } from \"../api/authAPI\";\r\nimport { fetchUserDetailsAPI, updateUserDetailsAPI } from \"../api/userAPI\";\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\r\n  const [user, setUser] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"authToken\");\r\n    const userId = localStorage.getItem(\"userId\");\r\n\r\n    if (token && userId) {\r\n      fetchUserDetailsAPI(token, userId)\r\n        .then((data) => {\r\n          setUser(data);\r\n          setIsLoggedIn(true);\r\n        })\r\n        .catch(() => {\r\n          console.error(\"Session expired or invalid token.\");\r\n          localStorage.removeItem(\"authToken\");\r\n          localStorage.removeItem(\"userId\");\r\n          setIsLoggedIn(false);\r\n        });\r\n    }\r\n  }, []);\r\n\r\n  const loginHandler = async (email, password) => {\r\n    try {\r\n      const data = await loginAPI(email, password);\r\n      localStorage.setItem(\"authToken\", data.token); // Store token\r\n      console.log(\"Token saved to localstorage: \" + data.token);\r\n      localStorage.setItem(\"userId\", data.user.id); // Store user ID\r\n      console.log(\"User ID saved to localstorage: \" + data.user.id);\r\n      setUser(data.user); // Set user in state\r\n      setIsLoggedIn(true); // Update logged-in state\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Login failed:\", error.message);\r\n      return false;\r\n    }\r\n  };  \r\n\r\n  const registerHandler = async (userDetails) => {\r\n    try {\r\n      await registerAPI(userDetails);\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Registration failed:\", error.message);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const updateDetailsHandler = async (updatedDetails) => {\r\n    try {\r\n      const token = localStorage.getItem(\"authToken\");\r\n      const updatedUser = await updateUserDetailsAPI(token, updatedDetails);\r\n      setUser(updatedUser);\r\n      alert(\"Details updated successfully.\");\r\n    } catch (error) {\r\n      console.error(\"Failed to update user details:\", error.message);\r\n      alert(\"Failed to update details. Please try again.\");\r\n    }\r\n  };\r\n\r\n  const logoutHandler = () => {\r\n    localStorage.removeItem(\"authToken\");\r\n    localStorage.removeItem(\"userId\");\r\n    setUser(null);\r\n    setIsLoggedIn(false);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        isLoggedIn,\r\n        user,\r\n        login: loginHandler,\r\n        register: registerHandler,\r\n        updateDetails: updateDetailsHandler,\r\n        logout: logoutHandler,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}